---
phase: 02-data-driven-rules
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scraper.py
  - evaluate.py
autonomous: true

must_haves:
  truths:
    - "Aerospace companies (Boeing, Northrop Grumman, SpaceX) are auto-rejected"
    - "Semiconductor companies (Intel, Nvidia, AMD) are auto-rejected"
    - "Company blocklist check happens before description analysis"
    - "Golden test set still passes (no regressions)"
  artifacts:
    - path: "scraper.py"
      provides: "COMPANY_BLOCKLIST set and is_blocked_company() function"
      contains: "COMPANY_BLOCKLIST"
    - path: "scraper.py"
      provides: "Updated description_matches() accepting company_name parameter"
      contains: "def description_matches(description: str, company_name: str = None)"
  key_links:
    - from: "scraper.py"
      to: "description_matches()"
      via: "company_name parameter passed through"
      pattern: "description_matches.*company"
---

<objective>
Add company-level blocklist to filter out known false positive industries (aerospace/defense and semiconductor companies).

Purpose: The current filter only analyzes description text. Companies like Boeing, SpaceX, and Intel frequently post jobs mentioning "solar" (spacecraft solar panels) or "CAD" (chip design) that are false positives. Blocking at the company level is more precise than description-level exclusions.

Output: Updated scraper.py with COMPANY_BLOCKLIST and modified description_matches() function signature.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-data-driven-rules/02-RESEARCH.md
@scraper.py
@evaluate.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add company blocklist and update function signature</name>
  <files>scraper.py</files>
  <action>
1. Add COMPANY_BLOCKLIST constant near the top of scraper.py (after imports, before functions):

```python
# Company blocklist - known false positive industries
# Aerospace/defense companies use "solar" for spacecraft solar panels
# Semiconductor companies use "CAD" for chip design tools
COMPANY_BLOCKLIST = {
    # Aerospace/Defense
    'boeing', 'northrop grumman', 'lockheed', 'lockheed martin',
    'raytheon', 'spacex', 'blue origin', 'general dynamics',
    'bae systems', 'l3harris', 'leidos', 'huntington ingalls',
    'rtx', 'rtx corporation', 'sierra nevada corporation',
    # Semiconductor
    'intel', 'nvidia', 'amd', 'qualcomm', 'broadcom',
    'texas instruments', 'micron', 'applied materials',
    'lam research', 'kla', 'asml', 'marvell', 'microchip',
}
```

2. Update description_matches() function signature to accept optional company_name parameter:

```python
def description_matches(description: str, company_name: str = None) -> bool:
```

3. Add company blocklist check at the START of description_matches(), BEFORE the solar/PV check:

```python
def description_matches(description: str, company_name: str = None) -> bool:
    """Check if job description matches our criteria for solar design roles."""
    # Company blocklist check FIRST (before any description analysis)
    if company_name:
        company_lower = company_name.lower()
        for blocked in COMPANY_BLOCKLIST:
            if blocked in company_lower:
                return False

    if not description or pd.isna(description):
        return False
    # ... rest of existing logic unchanged
```

4. Update the call site in scrape_solar_jobs() to pass company name:

In the filter line around line 320, change:
```python
df = df[df['description'].apply(description_matches)]
```
to:
```python
df = df[df.apply(lambda row: description_matches(row['description'], row.get('company')), axis=1)]
```

NOTE: Keep the existing description_matches() logic completely unchanged after the new blocklist check. We are ONLY adding the company check at the beginning.
  </action>
  <verify>
Run: `python -c "from scraper import description_matches, COMPANY_BLOCKLIST; print(len(COMPANY_BLOCKLIST), 'companies in blocklist'); print('Boeing blocked:', not description_matches('solar designer', 'Boeing Company')); print('SunPower allowed:', description_matches('solar designer using Helioscope', 'SunPower'))"`

Expected output should show:
- 26+ companies in blocklist
- Boeing blocked: True
- SunPower allowed: True
  </verify>
  <done>
- COMPANY_BLOCKLIST constant exists with 26+ aerospace/semiconductor companies
- description_matches() accepts optional company_name parameter
- Company blocklist check runs before description analysis
- Existing description logic unchanged (backward compatible)
  </done>
</task>

<task type="auto">
  <name>Task 2: Update evaluate.py to pass company name</name>
  <files>evaluate.py</files>
  <action>
Update evaluate.py to pass company name when calling description_matches().

In the evaluate() function, change:

```python
predicted = description_matches(item["description"])
```

to:

```python
predicted = description_matches(item["description"], item.get("company"))
```

This allows the golden test set to include company names for more accurate testing.

NOTE: This is backward compatible - if an item doesn't have a "company" field, it passes None and the blocklist check is skipped.
  </action>
  <verify>
Run: `python evaluate.py --golden`

Expected: Same results as baseline (100% precision, 75% recall) since golden test set doesn't include blocked companies that were previously passing.
  </verify>
  <done>
- evaluate.py passes company name to description_matches()
- Golden test set evaluation produces same metrics (no regressions)
  </done>
</task>

<task type="auto">
  <name>Task 3: Add regression test items for blocked companies</name>
  <files>data/golden/golden-test-set.json</files>
  <action>
Add 2 new test items to the golden test set that verify company blocklist is working.

Add these items to the "items" array in golden-test-set.json:

```json
{
  "id": "golden_neg_blocked_company_01",
  "description": "Solar Designer at aerospace company. Join our team designing solar array systems for satellites. You will use AutoCAD and create design documents for photovoltaic systems in space applications. Solar energy experience preferred.",
  "company": "Boeing",
  "label": false,
  "category": "false_positive_blocked_company",
  "notes": "Tests company blocklist - Boeing should be blocked even with solar designer title"
},
{
  "id": "golden_neg_blocked_company_02",
  "description": "CAD Designer for power systems at semiconductor fab. Design CAD layouts for power distribution in solar cell manufacturing equipment. AutoCAD proficiency required.",
  "company": "Intel Corporation",
  "label": false,
  "category": "false_positive_blocked_company",
  "notes": "Tests company blocklist - Intel should be blocked despite CAD and solar mentions"
}
```

Update metadata to reflect the new items count.
  </action>
  <verify>
Run: `python evaluate.py --golden --verbose 2>&1 | grep -E "(blocked_company|MATCH|precision|recall)"`

Expected:
- Both new blocked_company items show [MATCH] (correctly rejected)
- Precision remains 100%
- Recall may decrease slightly (new negatives in denominator)
  </verify>
  <done>
- Golden test set includes 2 company blocklist test cases
- Both Boeing and Intel test cases are correctly rejected by filter
- No regressions in existing test cases
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Company blocklist functional:
   ```bash
   python -c "from scraper import COMPANY_BLOCKLIST; print(f'{len(COMPANY_BLOCKLIST)} companies blocked')"
   ```
   Expected: 26+ companies

2. No regressions on golden test:
   ```bash
   python evaluate.py --golden
   ```
   Expected: 100% precision maintained, 75% recall (or same as before)

3. Blocked companies rejected:
   ```bash
   python -c "from scraper import description_matches; print('Boeing rejected:', not description_matches('Solar Designer using Helioscope', 'Boeing'))"
   ```
   Expected: True

4. Non-blocked companies still work:
   ```bash
   python -c "from scraper import description_matches; print('SunPower accepted:', description_matches('Solar Designer using Helioscope', 'SunPower Corporation'))"
   ```
   Expected: True
</verification>

<success_criteria>
- COMPANY_BLOCKLIST contains aerospace/defense companies (Boeing, Northrop Grumman, SpaceX, Lockheed Martin, etc.)
- COMPANY_BLOCKLIST contains semiconductor companies (Intel, Nvidia, AMD, Qualcomm, etc.)
- description_matches() accepts optional company_name parameter
- Company blocklist check happens before description analysis
- Golden test set passes with no regressions
- New test items verify blocklist functionality
</success_criteria>

<output>
After completion, create `.planning/phases/02-data-driven-rules/02-01-SUMMARY.md`
</output>
