---
phase: 02-data-driven-rules
plan: 03
type: execute
wave: 2
depends_on:
  - "02-01"
  - "02-02"
files_modified:
  - data/golden/golden-test-set.json
  - .planning/phases/02-data-driven-rules/02-METRICS.md
autonomous: true

must_haves:
  truths:
    - "Phase 2 metrics are documented with before/after comparison"
    - "Golden test set expanded to cover new exclusion categories"
    - "All new test cases pass (no regressions)"
    - "Precision maintained at 100% or improved"
  artifacts:
    - path: "data/golden/golden-test-set.json"
      provides: "Expanded test set with EDA, installer, and utility role test cases"
      min_lines: 280
    - path: ".planning/phases/02-data-driven-rules/02-METRICS.md"
      provides: "Phase 2 metrics documentation"
      contains: "Before Phase 2"
  key_links:
    - from: "data/golden/golden-test-set.json"
      to: "evaluate.py"
      via: "evaluate.py --golden reads test set"
      pattern: "golden-test-set"
---

<objective>
Validate Phase 2 rule additions and document metrics improvement.

Purpose: Ensure all new exclusion rules work correctly, expand the golden test set to cover new categories, and document the precision/recall changes for Phase 2.

Output: Expanded golden test set and 02-METRICS.md documenting Phase 2 results.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-metrics-foundation/01-BASELINE.md
@data/golden/golden-test-set.json
@scraper.py
@evaluate.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Expand golden test set with new exclusion categories</name>
  <files>data/golden/golden-test-set.json</files>
  <action>
Add test cases to cover the new exclusion categories added in Phase 2. Add these items to the "items" array:

```json
{
  "id": "golden_neg_eda_01",
  "description": "CAD Designer at chip company using Cadence Virtuoso for solar cell IC layout. You will create schematic and layout designs for power management ICs used in solar inverters. Experience with analog IC design and Virtuoso required. Understanding of photovoltaic power systems a plus.",
  "label": false,
  "category": "false_positive_eda_tools",
  "notes": "Tests EDA tool exclusion - Cadence Virtuoso is chip design, not solar design"
},
{
  "id": "golden_neg_eda_02",
  "description": "Design Engineer using Synopsys Design Compiler for solar MPPT controller ASIC. You will perform RTL synthesis and timing analysis using PrimeTime. Knowledge of power electronics and solar energy conversion preferred. Join our team designing next-gen solar inverter chips.",
  "label": false,
  "category": "false_positive_eda_tools",
  "notes": "Tests EDA tool exclusion - Synopsys tools indicate chip design role"
},
{
  "id": "golden_neg_installer_stringer_01",
  "description": "Solar Panel Stringer needed for installation crew. Join our team as a solar stringer laying panels on residential rooftops. You will work with crew lead to install solar arrays efficiently. No design work - this is physical installation labor. Training provided.",
  "label": false,
  "category": "false_positive_installer",
  "notes": "Tests stringer exclusion - installation labor, not design"
},
{
  "id": "golden_neg_installer_foreman_01",
  "description": "Solar Installation Foreman at growing PV company. Lead a crew of installers on commercial solar projects. You will coordinate daily work, ensure safety compliance, and manage installation timelines. AutoCAD experience helpful for reading drawings but no design responsibility.",
  "label": false,
  "category": "false_positive_installer",
  "notes": "Tests foreman exclusion - construction supervision, not design"
},
{
  "id": "golden_neg_utility_interconnection_01",
  "description": "Solar Interconnection Engineer at utility company. Manage utility interconnection process for solar generators. You will review interconnection applications, perform impact studies, and coordinate with solar developers. Knowledge of FERC regulations and utility tariffs required. Not a design role.",
  "label": false,
  "category": "false_positive_utility",
  "notes": "Tests interconnection engineer exclusion - utility interface role, not PV design"
},
{
  "id": "golden_neg_utility_grid_01",
  "description": "Grid Engineer supporting solar integration at regional utility. Analyze grid impacts of solar penetration, develop interconnection requirements, and model distribution feeders with high solar adoption. PSS/E and CYME experience required. Focus is on grid, not PV system design.",
  "label": false,
  "category": "false_positive_utility",
  "notes": "Tests grid engineer exclusion - utility grid focus, not PV design"
}
```

Also update the metadata section:
- Update "notes" to mention Phase 2 expansion

NOTE: Add these items AFTER the existing items. Do not modify or remove any existing items.
  </action>
  <verify>
Run: `python evaluate.py --golden --verbose 2>&1 | grep -E "(eda|stringer|foreman|interconnection|grid_01)" | head -10`

Expected: All new items show [MATCH] indicating correct rejection.
  </verify>
  <done>
- Golden test set includes 2 EDA tool false positive cases
- Golden test set includes 2 installer role cases (stringer, foreman)
- Golden test set includes 2 utility role cases (interconnection, grid)
- All new test cases correctly rejected by filter
  </done>
</task>

<task type="auto">
  <name>Task 2: Run full evaluation and document metrics</name>
  <files>.planning/phases/02-data-driven-rules/02-METRICS.md</files>
  <action>
Run the evaluation and create 02-METRICS.md with before/after comparison.

1. First, run: `python evaluate.py --golden`
2. Capture the output metrics
3. Create the metrics document:

```markdown
# Phase 2: Data-Driven Rules - Metrics

**Measured:** [current date]
**Golden Test Set:** data/golden/golden-test-set.json

## Phase 2 Changes Summary

### Rules Added
1. **Company Blocklist** (RULE-01)
   - 26+ aerospace/defense companies (Boeing, Northrop Grumman, SpaceX, etc.)
   - 13+ semiconductor companies (Intel, Nvidia, AMD, etc.)

2. **Installer Role Exclusions** (RULE-02)
   - Added: stringer, roofer, foreman, crew lead, panel installer

3. **Utility Engineering Exclusions** (RULE-02)
   - Added: interconnection engineer, grid engineer, protection engineer, metering engineer

4. **EDA Tool Exclusions** (RULE-03)
   - Added: Cadence, Synopsys, Mentor Graphics + 18 specific tool names

## Metrics Comparison

### Before Phase 2 (Baseline from Phase 1)

| Metric | Value |
|--------|-------|
| Precision | 100.00% |
| Recall | 75.00% |
| F1 Score | 85.71% |
| Test Set Size | 33 items |

### After Phase 2

| Metric | Value |
|--------|-------|
| Precision | [from evaluation] |
| Recall | [from evaluation] |
| F1 Score | [from evaluation] |
| Test Set Size | [from evaluation] |

### Change Analysis

[Document what changed and why]

## Test Coverage by Category

| Category | Count | All Pass? |
|----------|-------|-----------|
| tier1_tool_match | 3 | Yes |
| tier2_strong_signals | 3 | [check] |
| tier3_cad_with_context | 2 | Yes |
| tier4_title_signals | 2 | [check] |
| tier5_cad_design_role | 2 | [check] |
| tier6_solar_design_titles | 4 | Yes |
| false_positive_tennis | 1 | Yes |
| false_positive_aerospace | 3 | Yes |
| false_positive_semiconductor | 2 | Yes |
| false_positive_installer | 5 | Yes |
| false_positive_sales | 2 | Yes |
| false_positive_management | 2 | Yes |
| false_positive_other_engineering | 2 | Yes |
| false_positive_utility | 4 | Yes |
| false_positive_blocked_company | 2 | Yes |
| false_positive_eda_tools | 2 | Yes |

## Requirements Satisfied

- [x] RULE-01: Company blocklist excludes known false positive companies
- [x] RULE-02: Missing role exclusions added (stringer, roofer, foreman, interconnection engineer)
- [x] RULE-03: EDA tool exclusions added (Cadence, Synopsys for chip design)
- [x] RULE-04: Filter terms extracted from analysis (documented in 02-RESEARCH.md)

## Notes

[Any observations about the metrics]

---
*Metrics measured: [current date]*
```

Fill in the [bracketed] values from actual evaluation output.
  </action>
  <verify>
Run: `ls -la .planning/phases/02-data-driven-rules/02-METRICS.md && head -50 .planning/phases/02-data-driven-rules/02-METRICS.md`

Expected: File exists with populated metrics values.
  </verify>
  <done>
- 02-METRICS.md created with before/after comparison
- All Phase 2 requirement statuses documented
- Test coverage by category documented
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify success criteria met</name>
  <files>None (verification only)</files>
  <action>
Run verification checks to confirm all Phase 2 success criteria are met:

1. Company blocklist works:
```bash
python -c "from scraper import description_matches; print('Boeing blocked:', not description_matches('Solar Designer at Boeing working on satellite solar panels', 'Boeing'))"
```

2. New role exclusions work:
```bash
python -c "from scraper import description_matches; print('stringer blocked:', not description_matches('Solar stringer for installation crew', None)); print('interconnection blocked:', not description_matches('Solar interconnection engineer at utility', None))"
```

3. EDA exclusions work:
```bash
python -c "from scraper import description_matches; print('Cadence blocked:', not description_matches('CAD Designer using Cadence for solar IC', None))"
```

4. Full golden test passes:
```bash
python evaluate.py --golden
```

5. Precision maintained (verify 100% in output)
  </action>
  <verify>
All verification commands should return True/expected values.

Golden test should show:
- Precision: 100% (maintained)
- No false positives
- All new test items correctly classified
  </verify>
  <done>
- Company blocklist blocks aerospace/semiconductor false positives
- New role exclusions block installer/field tech false positives
- EDA tool exclusions block chip design false positives
- Precision maintained at 100%
- All Phase 2 requirements satisfied
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Golden test set expanded:
   ```bash
   python -c "import json; data = json.load(open('data/golden/golden-test-set.json')); print(f'{len(data[\"items\"])} test items (was 33, now ~41)')"
   ```
   Expected: 41+ items

2. All test cases pass:
   ```bash
   python evaluate.py --golden
   ```
   Expected: 100% precision, recall documented

3. Metrics document exists:
   ```bash
   ls .planning/phases/02-data-driven-rules/02-METRICS.md
   ```
   Expected: File exists

4. Requirements check:
   ```bash
   grep -E "RULE-0[1-4].*\[x\]" .planning/phases/02-data-driven-rules/02-METRICS.md
   ```
   Expected: All 4 requirements marked complete
</verification>

<success_criteria>
- Golden test set expanded from 33 to 41+ items covering new categories
- All test cases pass (no regressions from Phase 1)
- 02-METRICS.md documents before/after metrics comparison
- Precision maintained at 100% (or improved)
- All 4 Phase 2 requirements (RULE-01 through RULE-04) documented as satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/02-data-driven-rules/02-03-SUMMARY.md`
</output>
